
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dwdas9.github.io/home/Spark-DataBricks/2.0_Spark_To_ADLS/2.0_Spark_To_ADLS.html">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Spark-To-ADLS-Connection - Das Digital Digest</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#table-of-contents" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Das Digital Digest" class="md-header__button md-logo" aria-label="Das Digital Digest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Das Digital Digest
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spark-To-ADLS-Connection
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Das Digital Digest" class="md-nav__button md-logo" aria-label="Das Digital Digest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Das Digital Digest
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Engineering & Analytics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Data Engineering & Analytics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apache Airflow
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Apache Airflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Airflow/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Airflow/1.0.0_AirFlow_Concepts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Airflow/1.0.1_A_Dags_Anatomy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAG Anatomy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Airflow/1.0.2_Hello_Airflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello Airflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Airflow/1.0.3_Airflow_Dbt_Docker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow DBT Docker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark & Databricks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Spark & Databricks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stream Processing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Stream Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../StreamProcessing/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SQL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL/best-practices.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL/performance-tuning.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud & DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cloud & DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Microsoft Fabric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Microsoft Fabric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Microsoft-Fabric/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Azure Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Synapse-ADF/synapse.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synapse Analytics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Synapse-ADF/adf.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Factory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            GitHub Actions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DevOps/1_GitHub-Concepts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DevOps/1.1_Hello_GitHub_Actions_Workflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            Azure DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DevOps/2_Azure-Pipelines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DevOps/ADF_CICD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADF CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DockerAndKubernetes/AirflowDocker/1_AirflowDocker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airflow on Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DockerAndKubernetes/SparkHiveHadoop/4.9_DockerConcepts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DockerAndKubernetes/kubernetes/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Enterprise Solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Enterprise Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Microsoft 365
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Microsoft 365
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../M365/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../M365/sharepoint.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SharePoint
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power Platform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Power Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PowerPlatform/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PowerPlatform/powerbi.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power BI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PowerPlatform/automate.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Automate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PowerPlatform/CalculationGroups.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calculation Groups
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MongoDB
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/best-practices.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/data-processing.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/automation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Engineering
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Data Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure Sky Weather
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            Azure Sky Weather
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/AzureSkyWeather/HomeProjectAzureSkyWeather.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingestion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            Ingestion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/AzureSkyWeather/1_Ingestion/HttpTriggered/HTTPTriggered_AzureFunc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Triggered Function
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/AzureSkyWeather/1_Ingestion/TimerTriggered/TimerTriggered_AzureFunc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Timer Triggered Function
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/CurrencyPredictor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Currency Predictor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/JsonValidator/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ETL Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            ETL Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/Csv-To-MSSQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSV to MSSQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/FetchJsonWriteParquet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON to Parquet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DE-Projects/Dbrk-E2E-AttritionProject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks E2E Project
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscellaneous
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Misc/10_Fact_vs_Dimension_tables.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fact vs Dimension Tables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-sparkzure-part1-connecting-local-spark-to-azure-data-lake" class="md-nav__link">
    <span class="md-ellipsis">
      Project Sparkzure Part1 - Connecting Local Spark to Azure Data Lake
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Sparkzure Part1 - Connecting Local Spark to Azure Data Lake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kickstart-integrating-spark-with-azure-data-lake" class="md-nav__link">
    <span class="md-ellipsis">
      Kickstart: Integrating Spark with Azure Data Lake
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kickstart: Integrating Spark with Azure Data Lake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-containerized-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Create the containerized setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-an-app-for-oauth-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Register an App for OAuth Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Register an App for OAuth Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-a-new-app-using-app-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Register a new App using App Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-ids-and-secret-from-the-app" class="md-nav__link">
    <span class="md-ellipsis">
      Copy Ids and secret From The App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#give-the-app-permission-to-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Give the App Permission to the Container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-adls-data-from-spark-using-oauth-authentication-and-service-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Access ADLS Data From Spark Using OAuth Authentication and Service Principal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Access ADLS Data From Spark Using OAuth Authentication and Service Principal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-vs-code-and-connect-to-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Open VS Code and Connect To the Container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-code" class="md-nav__link">
    <span class="md-ellipsis">
      Run the code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-data-in-adls-container-using-storage-accounts-access-key-method" class="md-nav__link">
    <span class="md-ellipsis">
      Access data in ADLS container using Storage Account's Access Key Method
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Common Errors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorizationpermissionmismatch-during-oauth-authenticaiton" class="md-nav__link">
    <span class="md-ellipsis">
      AuthorizationPermissionMismatch During OAuth Authenticaiton
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-does-spark-rely-on-hadoop-libraries-to-access-azure-data-lake-storage-adls" class="md-nav__link">
    <span class="md-ellipsis">
      Why Does Spark Rely on Hadoop Libraries to Access Azure Data Lake Storage (ADLS)?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-essential-jars-for-azure-data-lake-operations-with-spark" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Essential JARs for Azure Data Lake Operations with Spark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-sparkzure-part2-sorting-files-in-adls-container-using-standalone-spark" class="md-nav__link">
    <span class="md-ellipsis">
      Project Sparkzure Part2 - Sorting Files in ADLS Container Using Standalone Spark
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Sparkzure Part2 - Sorting Files in ADLS Container Using Standalone Spark">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-of-the-article" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of the Article
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my-environment" class="md-nav__link">
    <span class="md-ellipsis">
      My Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      The scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kickstart" class="md-nav__link">
    <span class="md-ellipsis">
      Kickstart
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-jars-by-running-this-command-from-terminal" class="md-nav__link">
    <span class="md-ellipsis">
      Download the jars by running this command from terminal:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-spark-code" class="md-nav__link">
    <span class="md-ellipsis">
      Run the Spark Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendix_1" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#programmatic-options-for-creating-containers-sorting-files-etc" class="md-nav__link">
    <span class="md-ellipsis">
      Programmatic options for Creating Containers, Sorting Files etc:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-spark-configuration-sparkjarspackages-vs-sparkjars" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Spark Configuration: spark.jars.packages vs spark.jars
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Spark Configuration: spark.jars.packages vs spark.jars">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-role-of-configsparkjarspackages" class="md-nav__link">
    <span class="md-ellipsis">
      The Role of .config('spark.jars.packages', '...')
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Role of .config('spark.jars.packages', '...')">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How it Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-utility-of-configsparkjars" class="md-nav__link">
    <span class="md-ellipsis">
      The Utility of .config('spark.jars', '...')
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Utility of .config('spark.jars', '...')">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-functions" class="md-nav__link">
    <span class="md-ellipsis">
      How it Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Example Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion_1" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h2 id="table-of-contents">Table of contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#project-sparkzure-part1---connecting-local-spark-to-azure-data-lake">Project Sparkzure Part1 - Connecting Local Spark to Azure Data Lake</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#kickstart-integrating-spark-with-azure-data-lake">Kickstart: Integrating Spark with Azure Data Lake</a><ul>
<li><a href="#create-the-containerized-setup">Create the containerized setup</a></li>
<li><a href="#register-an-app-for-oauth-authentication">Register an App for OAuth Authentication</a></li>
<li><a href="#register-a-new-app-using-app-registration">Register a new App using App Registration</a></li>
<li><a href="#copy-ids-and-secret-from-the-app">Copy Ids and secret From The App</a></li>
<li><a href="#give-the-app-permission-to-the-container">Give the App Permission to the Container</a></li>
<li><a href="#access-adls-data-from-spark-using-oauth-authentication-and-service-principal">Access ADLS Data From Spark Using OAuth Authentication and Service Principal</a></li>
<li><a href="#open-vs-code-and-connect-to-the-container">Open VS Code and Connect To the Container</a></li>
<li><a href="#run-the-code">Run the code</a></li>
<li><a href="#access-data-in-adls-container-using-storage-accounts-access-key-method">Access data in ADLS container using Storage Account's Access Key Method</a></li>
</ul>
</li>
<li><a href="#common-errors">Common Errors</a><ul>
<li><a href="#authorizationpermissionmismatch-during-oauth-authenticaiton">AuthorizationPermissionMismatch During OAuth Authenticaiton</a></li>
</ul>
</li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#why-does-spark-rely-on-hadoop-libraries-to-access-azure-data-lake-storage-adls">Why Does Spark Rely on Hadoop Libraries to Access Azure Data Lake Storage (ADLS)?</a></li>
<li><a href="#understanding-essential-jars-for-azure-data-lake-operations-with-spark">Understanding Essential JARs for Azure Data Lake Operations with Spark</a></li>
</ul>
</li>
<li><a href="#project-sparkzure-part2---sorting-files-in-adls-container-using-standalone-spark">Project Sparkzure Part2 - Sorting Files in ADLS Container Using Standalone Spark</a><ul>
<li><a href="#overview-of-the-article">Overview of the Article</a></li>
<li><a href="#my-environment">My Environment</a></li>
<li><a href="#the-scenario">The scenario</a></li>
<li><a href="#kickstart">Kickstart</a></li>
<li><a href="#environment-setup">Environment Setup</a><ul>
<li><a href="#download-the-jars-by-running-this-command-from-terminal">Download the jars by running this command from terminal:</a></li>
<li><a href="#copy-the-jars-to-the-spark_homejars-location">Copy the jars to the SPARK_HOME/Jars location</a></li>
</ul>
</li>
<li><a href="#run-the-spark-code">Run the Spark Code</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#appendix-1">Appendix</a></li>
<li><a href="#programmatic-options-for-creating-containers-sorting-files-etc">Programmatic options for Creating Containers, Sorting Files etc:</a></li>
</ul>
</li>
<li><a href="#understanding-spark-configuration-sparkjarspackages-vs-sparkjars">Understanding Spark Configuration: <code>spark.jars.packages</code> vs <code>spark.jars</code></a></li>
<li><a href="#the-role-of-configsparkjarspackages-">The Role of <code>.config('spark.jars.packages', '...')</code></a><ul>
<li><a href="#how-it-works">How it Works</a></li>
<li><a href="#example-usage">Example Usage</a></li>
</ul>
</li>
<li><a href="#the-utility-of-configsparkjars-">The Utility of <code>.config('spark.jars', '...')</code></a><ul>
<li><a href="#how-it-functions">How it Functions</a></li>
<li><a href="#example-implementation">Example Implementation</a></li>
</ul>
</li>
<li><a href="#conclusion-1">Conclusion</a></li>
</ul>
<hr />
<h1 id="project-sparkzure-part1-connecting-local-spark-to-azure-data-lake">Project Sparkzure Part1 - Connecting Local Spark to Azure Data Lake<a class="headerlink" href="#project-sparkzure-part1-connecting-local-spark-to-azure-data-lake" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Azure Databricks to Azure Data Lake is easy and straightforward. All the requied jars pre-installed in Databricks. All you need to do is to create a session and connect. However, connecting a local Spark instance to Azure Data Lake can be complicated, especially when managing JAR dependencies. In this project, I will show you how to connect your local Spark application to ADLS and run a Spark query using Visual Studio Code. The local Spark application will be hosted in a container, but it can also be hosted locally locally ;-)</p>
<h2 id="kickstart-integrating-spark-with-azure-data-lake">Kickstart: Integrating Spark with Azure Data Lake<a class="headerlink" href="#kickstart-integrating-spark-with-azure-data-lake" title="Permanent link">&para;</a></h2>
<h3 id="create-the-containerized-setup">Create the containerized setup<a class="headerlink" href="#create-the-containerized-setup" title="Permanent link">&para;</a></h3>
<p>Our environment is set up inside a Docker container running Ubuntu on a Windows OS host. Within this container, Python 3 and Spark are installed. But the steps can be used in local environments as well.</p>
<ul>
<li><strong>Check the python version in the container and find out site-packages directory</strong></li>
<li>
<p>Often, systems have both Python 2.x and Python 3.x installed. Use the following commands to determine which versions are available:
     <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>python<span class="w"> </span>--version
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>python3<span class="w"> </span>--version
</span></code></pre></div>
    <a class="glightbox" href="image-12.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-12.png" /></a></p>
</li>
<li>
<p>Determine where PySpark is installed using <code>pip</code>. Your enviornment may have multiple python installation especially if its linux or in a docker. You need to find the right <code>site-packages</code> directory so that the packages are copied to right location. To find out run this command in docker terminal or normal command prompt: </p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip3<span class="w"> </span>show<span class="w"> </span>pyspark<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Location
</span></code></pre></div>
 Alternatively, you can get the location by running the command:
 <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from distutils.sysconfig import get_python_lib; print(get_python_lib())&quot;</span>
</span></code></pre></div>
   <a class="glightbox" href="image-13.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-13.png" /></a></p>
</li>
<li>
<p><strong>Install <code>wget</code></strong></p>
</li>
<li>
<p><code>wget</code> is a tool for downloading files from the internet. If you don’t have it in your environment you can get it using the given command:
     <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>wget
</span></code></pre></div></p>
</li>
<li>
<p><strong>Download Hadoop ADLS JARs</strong></p>
<ul>
<li>I've downloaded and placed the jars <a href="Hadoop_Azure_Jars.zip">here</a>. Download and copy it to a desired location.</li>
<li>Alternatively, run the command below to download jars to your home directory</li>
</ul>
<p><code>bash
cd ~
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-azure/3.3.3/hadoop-azure-3.3.3.jar
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-azure-datalake/3.3.3/hadoop-azure-datalake-3.3.3.jar
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-common/3.3.3/hadoop-common-3.3.3.jar
wget https://repo1.maven.org/maven2/com/microsoft/azure/azure-storage/8.6.6/azure-storage-8.6.6.jar
wget https://repo1.maven.org/maven2/com/azure/azure-security-keyvault-secrets/4.3.0/azure-security-keyvault-secrets-4.3.0.jar
wget https://repo1.maven.org/maven2/com/azure/azure-identity/1.3.0/azure-identity-1.3.0.jar</code>
- After downloading, place the jars in any desired folder. These jars will be referenced during spark session creation.
- Alternatively you can use download the jars <a href="mavencoordinates.html">on-the-fly</a> using maven coordinates using <code>.config('spark.jars.packages', '...')</code></p>
</li>
</ul>
<h3 id="register-an-app-for-oauth-authentication">Register an App for OAuth Authentication<a class="headerlink" href="#register-an-app-for-oauth-authentication" title="Permanent link">&para;</a></h3>
<p>If you want to access a file(say CSV) in <strong>Azure</strong> through <strong>OAuth</strong> authentication, you need to create an <strong>App registration</strong> and grant this app permission to the CSV. This registered App's identity is used by <strong>Spark</strong> to authenticate. The same principle applies in <strong>Databricks</strong>, where an app is already created, named <strong>AzureDatabricks</strong>. Follow the steps below to register the app and give it permission to the file.</p>
<h4 id="register-a-new-app-using-app-registration">Register a new App using App Registration<a class="headerlink" href="#register-a-new-app-using-app-registration" title="Permanent link">&para;</a></h4>
<ul>
<li>In the Azure Portal to search for <strong>App registrations</strong>', select it, and opt for '+ New registration'. </li>
</ul>
<p><a class="glightbox" href="image-6.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-6" data-desc-position="bottom"><img alt="Image-6" src="image-6.png" /></a></p>
<ul>
<li>Give a name, say <strong><code>adlssparkapp</code></strong>, choose 'Accounts in this organizational directory only', keep the Redirect URI empty, and click <strong>Register</strong>. </li>
</ul>
<p><a class="glightbox" href="image-7.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-7" data-desc-position="bottom"><img alt="Image-7" src="image-7.png" /></a></p>
<h4 id="copy-ids-and-secret-from-the-app">Copy Ids and secret From The App<a class="headerlink" href="#copy-ids-and-secret-from-the-app" title="Permanent link">&para;</a></h4>
<ul>
<li>After registration, jot down the <strong>Application ID</strong> and <strong>Directory ID</strong>. </li>
</ul>
<p><a class="glightbox" href="image-8.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-8" data-desc-position="bottom"><img alt="Image-8" src="image-8.png" /></a></p>
<ul>
<li>Go to <strong>Manage</strong> &gt; <strong>Certificates &amp; secrets</strong>, select <strong>+ New client secret</strong>, label it <strong><code>SparkAppSecret</code></strong>, set an expiration, and click  'Add'. </li>
</ul>
<p><a class="glightbox" href="image-9.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-9" data-desc-position="bottom"><img alt="Image-9" src="image-9.png" /></a></p>
<ul>
<li>Post-creation, make note of the <strong>one-time</strong> viewable secret value essential for the Spark-Azure handshake. </li>
</ul>
<p><a class="glightbox" href="image-10.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-10" data-desc-position="bottom"><img alt="Image-10" src="image-10.png" /></a></p>
<h4 id="give-the-app-permission-to-the-container">Give the App Permission to the Container<a class="headerlink" href="#give-the-app-permission-to-the-container" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Open the container, navigate to <strong>Access Control (IAM)</strong> &gt; <strong>Role assignments</strong>, click <strong>Add</strong> &gt; <strong>Add role assignment</strong>, select <strong>Storage Blob Contributor</strong>, 
  <a class="glightbox" href="image-21.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-21.png" /></a></p>
</li>
<li>
<p>Search for the app <strong><code>adlssparkapp</code></strong>, and click <strong>OK</strong>.</p>
</li>
</ul>
<p><a class="glightbox" href="image-22.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-22.png" /></a></p>
<h3 id="access-adls-data-from-spark-using-oauth-authentication-and-service-principal">Access ADLS Data From Spark Using OAuth Authentication and Service Principal<a class="headerlink" href="#access-adls-data-from-spark-using-oauth-authentication-and-service-principal" title="Permanent link">&para;</a></h3>
<p>With the app now registered and the key, ID, and secret in hand, we can proceed to execute the main code. Follow the steps outlined below to continue:</p>
<h4 id="open-vs-code-and-connect-to-the-container">Open VS Code and Connect To the Container<a class="headerlink" href="#open-vs-code-and-connect-to-the-container" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Open VS Code</strong>: Launch Visual Studio Code and click the remote container icon at the bottom left.</li>
</ul>
<p><a class="glightbox" href="image-15.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-15" data-desc-position="bottom"><img alt="Image-15" src="image-15.png" /></a></p>
<ul>
<li><strong>Attach to Container</strong>: From the top menu, choose "Attach to running container".</li>
</ul>
<p><a class="glightbox" href="image-16.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-16" data-desc-position="bottom"><img alt="Image-16" src="image-16.png" /></a></p>
<ul>
<li><strong>Select Container</strong>: Pick the displayed running container. </li>
</ul>
<p><a class="glightbox" href="image-17.png" data-type="image" data-width="100%" data-height="auto" data-title="Image-17" data-desc-position="bottom"><img alt="Image-17" src="image-17.png" /></a></p>
<p>This action launches a new VS Code instance connected to that container.</p>
<p><a class="glightbox" href="image-18.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-18.png" /></a></p>
<ul>
<li>
<p><strong>Create Notebook</strong>: In this instance, create a .ipynb (Jupyter notebook) to execute the subsequent section's code.
   <a class="glightbox" href="image-19.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-19.png" /></a></p>
</li>
<li>
<p><strong>Connect to the python version where we copied the hadoop jars</strong>
   There could be multiple python versions in a linux enviornment. From VS Code choose the python version whcih has our jars</p>
</li>
</ul>
<p><a class="glightbox" href="image-20.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-20.png" /></a></p>
<h4 id="run-the-code">Run the code<a class="headerlink" href="#run-the-code" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code>Run the code below in the jupyter notebok:
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># Initialize a Spark session with necessary configurations for connecting to ADLS</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1">#Offline version</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;ADLS Access&quot;</span><span class="p">)</span> \
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.jars&quot;</span><span class="p">,</span> <span class="s2">&quot;/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-3.3.3.jar,/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-datalake-3.3.3.jar,/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-common-3.3.3.jar&quot;</span><span class="p">)</span> \
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="c1"># Or using maven coordinates</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1"># Online version</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;ADLS Access&quot;</span><span class="p">)</span> \
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.jars.packages&quot;</span><span class="p">,</span> 
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>            <span class="s2">&quot;org.apache.hadoop:hadoop-azure:3.3.3,&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span class="s2">&quot;org.apache.hadoop:hadoop-azure-datalake:3.3.3,&quot;</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>            <span class="s2">&quot;org.apache.hadoop:hadoop-common:3.3.3&quot;</span><span class="p">)</span> \
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="c1"># Define credentials and storage account details for ADLS access</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">storage_account</span> <span class="o">=</span> <span class="s2">&quot;&lt;The_Storage_Act_Name_Containing_Container&gt;&quot;</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="n">app_client_id</span> <span class="o">=</span> <span class="s2">&quot;&lt;The_Client_ID_From_Registered_App&gt;&quot;</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">app_directory_tenant_id</span> <span class="o">=</span> <span class="s2">&quot;&lt;The_Client_ID_From_Registered_App&gt;&quot;</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="n">app_client_secret</span> <span class="o">=</span> <span class="s2">&quot;&lt;The_Secret_Value_From_Registered_App&gt;&quot;</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="c1"># Configure Spark to use OAuth authentication for ADLS access</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.auth.type.</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="s2">&quot;OAuth&quot;</span><span class="p">)</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth.provider.type.</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider&quot;</span><span class="p">)</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.id.</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="n">app_client_id</span><span class="p">)</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.secret.</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="n">app_client_secret</span><span class="p">)</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.endpoint.</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{</span><span class="n">app_directory_tenant_id</span><span class="si">}</span><span class="s2">/oauth2/token&quot;</span><span class="p">)</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="c1"># Define the path to the dataset in ADLS and read the CSV file using Spark</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;abfss://&lt;containerName&gt;@&lt;storaegaccountname&gt;.dfs.core.windows.net/&lt;CSV_File_Name.csv&gt;&quot;</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="access-data-in-adls-container-using-storage-accounts-access-key-method">Access data in ADLS container using Storage Account's Access Key Method<a class="headerlink" href="#access-data-in-adls-container-using-storage-accounts-access-key-method" title="Permanent link">&para;</a></h3>
<p>Another methods to access ADLS is using the Access key method. Here we get the access key from the storage account then use it to access the files inside it. To use this method, follow these steps:</p>
<ul>
<li><strong>Get the Access Keys from the Storage Account</strong></li>
<li>In your storage account, under the <code>Security + networking</code> section in the left sidebar, find and select <code>Access keys</code>.</li>
<li>
<p>You’ll be presented with two keys: <code>key1</code> and <code>key2</code>. Both keys can be used to authenticate, so choose one and copy it. This will be used in the subsequent steps.</p>
<p><a class="glightbox" href="image-23.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-23.png" /></a></p>
</li>
<li>
<p><strong>Execute the code</strong><br />
After getting the access key use this code. Replace your access key in the access key location:</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Import the required module for creating a Spark session.</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># Initialize the Spark session. The builder pattern is utilized to configure the session.</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># We set the application name to &quot;ADLS Access&quot; for identification in Spark UI.</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1"># Necessary JAR files are specified for Spark to connect and interact with Azure Data Lake Storage (ADLS).</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;ADLS Access&quot;</span><span class="p">)</span> \
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.jars&quot;</span><span class="p">,</span> <span class="s2">&quot;/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-3.3.3.jar,/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-datalake-3.3.3.jar,/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-common-3.3.3.jar&quot;</span><span class="p">)</span> \
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="c1"># Specify the Azure storage account name and the associated access key for authentication purposes.</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">storage_account_name</span> <span class="o">=</span> <span class="s2">&quot;&lt;The_Storage_Account_Name&gt;&quot;</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="n">storage_account_key</span> <span class="o">=</span> <span class="s2">&quot;&lt;key1_or_key2&gt;&quot;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="c1"># Configure Spark to utilize AzureBlobFileSystem. This is essential for Azure Blob storage connectivity.</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure&quot;</span><span class="p">,</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem&quot;</span><span class="p">)</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="c1"># Authenticate the Spark session by providing the access key for the specified Azure storage account.</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.key.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="n">storage_account_key</span><span class="p">)</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="c1"># Read the desired CSV file located in ADLS into a DataFrame (df) using Spark.</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;abfss://&lt;container_name&gt;@</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net/&lt;filename.csv&gt;&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="common-errors">Common Errors<a class="headerlink" href="#common-errors" title="Permanent link">&para;</a></h2>
<h3 id="authorizationpermissionmismatch-during-oauth-authenticaiton">AuthorizationPermissionMismatch During OAuth Authenticaiton<a class="headerlink" href="#authorizationpermissionmismatch-during-oauth-authenticaiton" title="Permanent link">&para;</a></h3>
<p>While executing the code you may encounter errors like:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>AuthorizationPermissionMismatch, &quot;This request is not authorized to perform this operation using this permission.&quot;
</span></code></pre></div>
or</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>java.nio.file.AccessDeniedException: Operation failed: &quot;This request is not authorized to perform this operation using this permission.&quot;, 403, HEAD, https://strgacweatherapp.dfs.core.windows.net/weather-timer/2023-10-19-09.json?upn=false&amp;action=getStatus&amp;timeout=90
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem.checkException(AzureBlobFileSystem.java:1384)
</span></code></pre></div>
<p><a class="glightbox" href="image-11.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-11.png" /></a></p>
<p>OAuth uses a registered apps identity to connect. This app should have permission to the folder where the file resides.</p>
<p><a class="glightbox" href="image-25.png" data-type="image" data-width="100%" data-height="auto" data-title="Alt text" data-desc-position="bottom"><img alt="Alt text" src="image-25.png" /></a></p>
<h2 id="appendix">Appendix<a class="headerlink" href="#appendix" title="Permanent link">&para;</a></h2>
<h3 id="why-does-spark-rely-on-hadoop-libraries-to-access-azure-data-lake-storage-adls">Why Does Spark Rely on Hadoop Libraries to Access Azure Data Lake Storage (ADLS)?<a class="headerlink" href="#why-does-spark-rely-on-hadoop-libraries-to-access-azure-data-lake-storage-adls" title="Permanent link">&para;</a></h3>
<p><strong>Long story short</strong>: In a standalone Spark setup, we use specific Hadoop JARs solely for connecting to ADLS. It's important to note that these are just JARs and don't represent the full Hadoop ecosystem. </p>
<p>Apache Spark is used for distributed data processing. But for data storage it relies on other systems like ADLS, S3 etc. But why, when connecting Spark to ADLS, do we bring Hadoop into the picture? Let’s find out.</p>
<p><strong>Spark's Core Functionality:</strong>
Spark is designed to process data, not to understand the intricacies of every storage system. It can pull data from various sources, but it doesn't always have native integrations for each one.</p>
<p><strong>Hadoop's Role:</strong>
Hadoop, primarily known for its distributed file system (HDFS), also <strong>offers connectors to diverse storage systems</strong>. Over time, it has become the standard bridge between storage solutions and big data tools.</p>
<p><strong>ADLS and Hadoop Integration:</strong>
When Microsoft developed ADLS, they provided a connector to the Hadoop FileSystem API. This approach made sense. Why reinvent the wheel when big data tools already communicate efficiently with HDFS via Hadoop's API?</p>
<p><strong>Conclusion</strong></p>
<p>HSpark uses Hadoop libraries to access ADLS due to the standardized and robust nature of the Hadoop FileSystem API. Microsoft integrated ADLS with this Hadoop API to ensure that ADLS would be compatible with a broad range of big data tools, such as Spark and Hive. This decision was to use the extensive community support of the Hadoop ecosystem and also allowed Microsoft to reuse what was already working In essence, the Hadoop API serves as a bridge between Spark and ADLS.</p>
<h3 id="understanding-essential-jars-for-azure-data-lake-operations-with-spark">Understanding Essential JARs for Azure Data Lake Operations with Spark<a class="headerlink" href="#understanding-essential-jars-for-azure-data-lake-operations-with-spark" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>hadoop-azure-3.3.3.jar</strong>:</li>
<li><strong>Description</strong>: This library provides support for Azure Blob Storage integration with Hadoop. It contains the <code>WASB</code> (Windows Azure Storage Blob) file system connector.</li>
<li>
<p><strong>Use-Cases</strong>: Reading/writing data from/to Azure Blob Storage (often ADLS Gen1) using Hadoop's FileSystem API.</p>
</li>
<li>
<p><strong>hadoop-azure-datalake-3.3.3.jar</strong>:</p>
</li>
<li><strong>Description</strong>: This is the Data Lake connector for Hadoop, providing support for ADLS Gen1.</li>
<li>
<p><strong>Use-Cases</strong>: If you're working with ADLS Gen1, this JAR lets Spark access the data lake using the Hadoop FileSystem API.</p>
</li>
<li>
<p><strong>hadoop-common-3.3.3.jar</strong>:</p>
</li>
<li><strong>Description</strong>: The core library for Hadoop, it contains common utilities and the Hadoop FileSystem API.</li>
<li>
<p><strong>Use-Cases</strong>: Fundamental for almost all Hadoop-related operations. It's the foundational library upon which other Hadoop components rely.</p>
</li>
<li>
<p><strong>azure-storage-8.6.6.jar</strong>:</p>
</li>
<li><strong>Description</strong>: Azure's storage SDK, facilitating interaction with Azure Storage services like Blob, Queue, and Table.</li>
<li>
<p><strong>Use-Cases</strong>: Interacting with Azure Blob Storage (and by extension, ADLS Gen2 which is built on Blob). It's essential for Spark to communicate and access Azure storage services.</p>
</li>
<li>
<p><strong>azure-security-keyvault-secrets-4.3.0.jar</strong>:</p>
</li>
<li><strong>Description</strong>: Provides capabilities to interact with Azure Key Vault's secrets. It facilitates fetching, setting, or managing secrets.</li>
<li>
<p><strong>Use-Cases</strong>: Whenever you need to securely access or manage secrets (like storage account keys or database connection strings) stored in Azure Key Vault from your Spark application.</p>
</li>
<li>
<p><strong>azure-identity-1.3.0.jar</strong>:</p>
</li>
<li><strong>Description</strong>: Azure SDK's identity library, providing various credentials classes for Azure Active Directory (AAD) token authentication.</li>
<li><strong>Use-Cases</strong>: Authenticating against Azure services using AAD-based credentials, especially when trying to securely access resources like Key Vault or ADLS Gen2.</li>
</ol>
<hr />
<h1 id="project-sparkzure-part2-sorting-files-in-adls-container-using-standalone-spark">Project Sparkzure Part2 - Sorting Files in ADLS Container Using Standalone Spark<a class="headerlink" href="#project-sparkzure-part2-sorting-files-in-adls-container-using-standalone-spark" title="Permanent link">&para;</a></h1>
<h3 id="overview-of-the-article">Overview of the Article<a class="headerlink" href="#overview-of-the-article" title="Permanent link">&para;</a></h3>
<p>In Part 1, we dived into accessing ADLS files with Pyspark and Hadoop Jars. Now, let's switch gears a bit. In this article, we'll explore how to sort—by creating containers and moving/renaming files—the content in an Azure Data Lake Container using just a Standalone Spark application. While there's always the route of Azure Data Factory, Databricks, or Azure Logic Apps, I want to spotlight this approach. Why? Because it's not only a viable alternative, but it also comes with the perk of being nearly cost-free compared to the other Azure services I mentioned.</p>
<h3 id="my-environment">My Environment<a class="headerlink" href="#my-environment" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Deployment Platform:</strong> Docker</li>
<li><strong>Operating System:</strong> Ubuntu</li>
<li><strong>Python Version:</strong> 3.8.10</li>
<li><strong>Development IDE:</strong> Visual Studio Code connected to the container</li>
<li><strong>Spark Setup:</strong> Standalone Spark installed as part of Pyspark(<code>pip install pyspark</code>)</li>
<li><strong>Spark Home</strong> /usr/local/lib/python3.8/dist-packages/pyspark/</li>
<li><strong>Jars Location</strong> /usr/local/lib/python3.8/dist-packages/pyspark/jars/</li>
</ul>
<h3 id="the-scenario">The scenario<a class="headerlink" href="#the-scenario" title="Permanent link">&para;</a></h3>
<p>We have a container name "weather-timer" that contains JSON files formatted as <code>YYYY-10-22-12.json</code>. These files hold weather information retrieved from a web API. The files need to be sorted in the format  <code>year=yyyy/month=mm/day=dd/hour=hh.json</code>. This is a real-world requirement, as a structure like this can make partition pruning more efficient during query time if you're using a system like Apache Hive or Delta Lake.</p>
<h3 id="kickstart">Kickstart<a class="headerlink" href="#kickstart" title="Permanent link">&para;</a></h3>
<h4 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h4>
<p>For ADLS connectivity in standalone PySpark, we need to download these 3 super-important Jars:
- <code>hadoop-azure-&lt;version&gt;.jar</code>: Supports Azure Blob Storage and Spark integration.
- <code>hadoop-azure-datalake-&lt;version&gt;.jar</code>: For for ADLS access, including authentication features.
- <code>hadoop-common-&lt;version&gt;.jar</code>: Contains utilities for the other JARs.</p>
<h5 id="download-the-jars-by-running-this-command-from-terminal">Download the jars by running this command from terminal:<a class="headerlink" href="#download-the-jars-by-running-this-command-from-terminal" title="Permanent link">&para;</a></h5>
<p>Run teh following command in terminal. Note: The version of jars might change over time.</p>
<p>```bash
cd ~
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-azure/3.3.3/hadoop-azure-3.3.3.jar
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-azure-datalake/3.3.3/hadoop-azure-datalake-3.3.3.jar
wget https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-common/3.3.3/hadoop-common-3.3.3.jar</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>##### Copy the jars to the SPARK_HOME/Jars location
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>```bash
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>   cd ~  # assuming you downloaded the JARs in the home directory
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>   cp *.jar /usr/local/lib/python3.8/dist-packages/pyspark/jars/
</span></code></pre></div>
<h4 id="run-the-spark-code">Run the Spark Code<a class="headerlink" href="#run-the-spark-code" title="Permanent link">&para;</a></h4>
<p>This is the code for performing the sorting. It checks if there are containers. If not, it makes them. Before you run the code, make sure you replace placeholders like <code>&lt;YOUR_STORAGE_ACT_NAME&gt;</code>, <code>&lt;YOUR_REG_APP_CLIENT_ID&gt;</code>, <code>&lt;YOUR_REG_APP_TENANT_ID&gt;</code>, <code>&lt;YOUR_REG_APP_CLIENT_SECRET&gt;</code>, <code>&lt;YOUR_CONTAINER_NAME&gt;</code>, and paths to JAR files with the actual values.. Also, update any other settings to match your system.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Importing the necessary module for SparkSession from the PySpark library.</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1">#Note: The location of jars is where we copied them after downloadign with wget. Just 3 jars.</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;ADLS Access&quot;</span><span class="p">)</span> \
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.jars&quot;</span><span class="p">,</span> 
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>            <span class="s2">&quot;/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-3.3.3.jar,&quot;</span>\
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>            <span class="s2">&quot;/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-azure-datalake-3.3.3.jar,&quot;</span>\
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>            <span class="s2">&quot;/usr/local/lib/python3.8/dist-packages/pyspark/jars/hadoop-common-3.3.3.jar&quot;</span><span class="p">)</span> \
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="c1"># Configuring PySpark for Azure Data Lake Storage (ADLS) Authentication using OAuth and Service Principal</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="c1"># Credentials and configurations</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">storage_account_name</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_STORAGE_ACT_NAME&gt;&quot;</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="n">regapp_client_id</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_REG_APP_CLIENT_ID&gt;&quot;</span> <span class="c1"># Application (client) ID of the registered app</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">regapp_directory_id</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_REG_APP_TENANT_ID&gt;&quot;</span> <span class="c1"># Directory (tenant) ID of the registered app</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="n">regapp_client_secret</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_REG_APP_CLIENT_SECRET&gt;&quot;</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="c1"># Set the authentication type to OAuth for the specified storage account---------------</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.auth.type.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="s2">&quot;OAuth&quot;</span><span class="p">)</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="c1"># Define the token provider type for OAuth. The &#39;ClientCredsTokenProvider&#39; is specified for the client credentials flow.</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth.provider.type.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider&quot;</span><span class="p">)</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="c1"># Provide the client ID (application ID) of the registered application in Azure Active Directory (AD).</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.id.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="n">regapp_client_id</span><span class="p">)</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="c1"># Set the client secret of the registered application. This acts as a password for the application to verify its identity.</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.secret.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="n">regapp_client_secret</span><span class="p">)</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="c1"># Specify the OAuth 2.0 token endpoint, allowing the application to retrieve tokens for authentication.</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fs.azure.account.oauth2.client.endpoint.</span><span class="si">{</span><span class="n">storage_account_name</span><span class="si">}</span><span class="s2">.dfs.core.windows.net&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{</span><span class="n">regapp_directory_id</span><span class="si">}</span><span class="s2">/oauth2/token&quot;</span><span class="p">)</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="c1">#----------------------------------------------------------------------------------------</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="c1">#---------Code to perform the sorting----------------------------------------------------</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="c1"># Define the ADLS Gen2 base path</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="n">base_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;abfss://&lt;YOUR_CONTAINER_NAME&gt;@&lt;YOUR_STORAGE_ACT_NAME&gt;.dfs.core.windows.net/&quot;</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="n">conf</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">_jsc</span><span class="o">.</span><span class="n">hadoopConfiguration</span><span class="p">()</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;fs.abfss.impl&quot;</span><span class="p">,</span> <span class="s2">&quot;org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem&quot;</span><span class="p">)</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="n">uri</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">URI</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="n">path_obj</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="n">file_system</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">FileSystem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">(</span><span class="n">base_path</span><span class="p">),</span> <span class="n">conf</span><span class="p">)</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="n">old_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">getPath</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">file_system</span><span class="o">.</span><span class="n">globStatus</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">base_path</span> <span class="o">+</span> <span class="s2">&quot;*-*.json&quot;</span><span class="p">))]</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="c1"># Diagnostic: Check the number of files fetched</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of files to be processed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">old_files</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="c1"># Test with a subset (for diagnostic purposes)</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="n">subset_of_files</span> <span class="o">=</span> <span class="n">old_files</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="k">for</span> <span class="n">old_file_path</span> <span class="ow">in</span> <span class="n">old_files</span><span class="p">:</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>    <span class="c1"># Extract year, month, day, and hour from the old file path</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">old_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>    <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>    <span class="c1"># Construct the new directory structure based on the desired format</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>    <span class="n">new_directory</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;year=</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/month=</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">/day=</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">/&quot;</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>    <span class="c1"># Check if the directory exists; if not, create it</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_system</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">new_directory</span><span class="p">)):</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>        <span class="n">file_system</span><span class="o">.</span><span class="n">mkdirs</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">new_directory</span><span class="p">))</span>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>    <span class="c1"># Construct the new file path</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>    <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">new_directory</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;hour=</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>    <span class="c1"># Diagnostic: Printing the move action</span>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moving </span><span class="si">{</span><span class="n">old_file_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>    <span class="c1"># Rename (move) the file to the new path and check if it&#39;s successful</span>
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>    <span class="n">success</span> <span class="o">=</span> <span class="n">file_system</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">old_file_path</span><span class="p">),</span> <span class="n">spark</span><span class="o">.</span><span class="n">_jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">hadoop</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">))</span>
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>    <span class="c1"># Diagnostic: Check if the move was successful</span>
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Move success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files rearranged successfully for the subset!&quot;</span><span class="p">)</span>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a><span class="c1">#---------Code to perform the sorting----------------------------------------------------</span>
</span></code></pre></div>
<h3 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h3>
<p>There are many ways to organize files in a container, like using ADF, Databricks, or Logic Apps. But this way is good too because it's free, unlike some pretty-expensive options like Databricks. I shared this article to let us know there's another option out there. It shows how we perform such operation on Azure DataLake from an outside standalone application.</p>
<h3 id="appendix_1">Appendix<a class="headerlink" href="#appendix_1" title="Permanent link">&para;</a></h3>
<h4 id="programmatic-options-for-creating-containers-sorting-files-etc">Programmatic options for Creating Containers, Sorting Files etc:<a class="headerlink" href="#programmatic-options-for-creating-containers-sorting-files-etc" title="Permanent link">&para;</a></h4>
<p>If you want to compare what other programmatic options we have to peroform such operation, here is the comparison:</p>
<ol>
<li>
<p><strong>Reading/Writing Large Datasets</strong>: </p>
<ul>
<li><strong>Best Tool</strong>: PySpark.</li>
<li><strong>Reason</strong>: Spark is designed for distributed data processing. Reading and processing large datasets from ADLS Gen2 into Spark dataframes will be efficient.</li>
</ul>
</li>
<li>
<p><strong>Listing Files in a Container/Directory</strong>:</p>
<ul>
<li><strong>Best Tool</strong>: PySpark or Hadoop FileSystem API.</li>
<li><strong>Reason</strong>: PySpark provides simple methods to list files, but if you're already interfacing with Hadoop's FileSystem API for other tasks, it's also a good choice.</li>
</ul>
</li>
<li>
<p><strong>Renaming or Moving Files</strong>:</p>
<ul>
<li><strong>Best Tool</strong>: Hadoop FileSystem API.</li>
<li><strong>Reason</strong>: While this can be done with the Azure SDK, the Hadoop FileSystem API provides a more direct interface when working alongside Spark.</li>
</ul>
</li>
<li>
<p><strong>Creating Containers or Directories</strong>:</p>
<ul>
<li><strong>Best Tool</strong>: Azure SDK (<code>azure-storage-file-datalake</code>).</li>
<li><strong>Reason</strong>: Creating containers or directories is a simple storage management task. The Azure SDK provides direct methods to do this without unnecessary overhead.</li>
</ul>
</li>
<li>
<p><strong>Setting Permissions or Managing Access</strong>:</p>
<ul>
<li><strong>Best Tool</strong>: Azure SDK.</li>
<li><strong>Reason</strong>: Managing permissions or access control is more straightforward with the Azure SDK, which provides methods tailored for these tasks.</li>
</ul>
</li>
</ol>
<hr />
<h1 id="understanding-spark-configuration-sparkjarspackages-vs-sparkjars">Understanding Spark Configuration: <code>spark.jars.packages</code> vs <code>spark.jars</code><a class="headerlink" href="#understanding-spark-configuration-sparkjarspackages-vs-sparkjars" title="Permanent link">&para;</a></h1>
<p>Apache Spark offers robust options for integrating external libraries, crucial for expanding its native capabilities. Two such configurations often used are <code>spark.jars.packages</code> and <code>spark.jars</code>. Understanding the distinct roles and applications of these configurations can significantly enhance how you manage dependencies in your Spark applications.</p>
<h2 id="the-role-of-configsparkjarspackages">The Role of <code>.config('spark.jars.packages', '...')</code><a class="headerlink" href="#the-role-of-configsparkjarspackages" title="Permanent link">&para;</a></h2>
<p>This configuration is quintessential when it comes to managing library dependencies via Maven coordinates. It's designed to streamline the process of including external libraries in your Spark application.</p>
<h3 id="how-it-works">How it Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Maven Coordinates</strong>: You specify the library using its Maven coordinates in the format <code>'groupId:artifactId:version'</code>.</li>
<li><strong>Automatic Download</strong>: Spark automates the download process, fetching the specified library from Maven Central or another configured Maven repository.</li>
<li><strong>Ease of Use</strong>: This method is particularly user-friendly, ensuring you're incorporating the correct library version without manually downloading the JAR files.</li>
</ul>
<h3 id="example-usage">Example Usage<a class="headerlink" href="#example-usage" title="Permanent link">&para;</a></h3>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s1">&#39;spark.jars.packages&#39;</span><span class="p">,</span> <span class="s1">&#39;org.apache.spark:spark-sql-kafka-0-10_2.12:3.3.0&#39;</span><span class="p">)</span>
</span></code></pre></div>
In this instance, Spark is instructed to download and include the Kafka connector compatible with Spark version 2.12 and version 3.3.0 of the library.</p>
<h2 id="the-utility-of-configsparkjars">The Utility of <code>.config('spark.jars', '...')</code><a class="headerlink" href="#the-utility-of-configsparkjars" title="Permanent link">&para;</a></h2>
<p>Contrasting <code>spark.jars.packages</code>, the <code>spark.jars</code> configuration is utilized when directly referencing locally stored JAR files.</p>
<h3 id="how-it-functions">How it Functions<a class="headerlink" href="#how-it-functions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Local File Path</strong>: You provide the absolute path to the JAR file already present on your system.</li>
<li><strong>No Automatic Download</strong>: Spark bypasses any downloading process, relying on the specified JAR file's presence in the given location.</li>
<li><strong>Custom or Offline Use</strong>: This approach is ideal for using custom library versions or in environments with restricted internet access.</li>
</ul>
<h3 id="example-implementation">Example Implementation<a class="headerlink" href="#example-implementation" title="Permanent link">&para;</a></h3>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s1">&#39;spark.jars&#39;</span><span class="p">,</span> <span class="s1">&#39;/opt/shared-data/spark-sql-kafka-0-10_2.13-3.4.0.jar&#39;</span><span class="p">)</span>
</span></code></pre></div>
Here, Spark is directed to incorporate a Kafka connector JAR file located at <code>/opt/shared-data/spark-sql-kafka-0-10_2.13-3.4.0.jar</code>.</p>
<h2 id="conclusion_1">Conclusion<a class="headerlink" href="#conclusion_1" title="Permanent link">&para;</a></h2>
<p>In summary, <code>spark.jars.packages</code> is a hassle-free solution for incorporating libraries using Maven coordinates, automating the downloading and version management. In contrast, <code>spark.jars</code> is suited for scenarios where you have a local JAR file, offering more control over the specific version and source of the library being used. The choice between these configurations hinges on your project's requirements and operational environment, providing flexibility in managing your Spark application's dependencies.</p>
<p>© D Das<br />
📧 <a href="mailto:das.d@hotmail.com">das.d@hotmail.com</a> | <a href="mailto:ddasdocs@gmail.com">ddasdocs@gmail.com</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - Das
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>